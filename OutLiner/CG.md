# 图形管线
## 应用阶段
CPU负责的阶段，由开发人员控制，CPU将决定传递给GPU什么样的数据(灯光，模型，摄像机位置),有时候还会对这些数据进行处理，剔除，并告诉GPU这些数据的渲染状态，纹理材质着色器。
## 几何阶段
从这里开始就是GPU内部的阶段，包括顶点着色器->曲面细分着色器->几何着色器->投影->裁剪->屏幕映射
### 顶点着色器
顶点着色器是可编程的，也就是vertex shader，GPU内部并行对每个顶点都调用vs进行计算，每两个顶点都是独立的互不影响，完全并行的计算。可以对顶点进行坐标变换，计算法线，计算顶点颜色。
### 曲面细分着色器
这个阶段会对模型的表面进行更加精细化的加工，使模型表面三角面更多，模型表面就更加平滑圆润，所以就会增加新的顶点
### 几何着色器(可选)
几何着色器的作用是生成图元，输入顶点，输出对应的图元

应用举例:法线可视化，对于光照效果的调试非常有帮助，首先在不使用几何着色器的情况下正常渲染一次场景，然后再开启几何着色器渲染一次，再几何着色器中通过法线的起点和终点，画一条线段。第一次渲染正常场景，第二次渲染只画法线

### 投影
将三维空间中的图元投影到二维平面上，这个阶段中，GPU将顶点从摄像机观察空间转换到裁剪空间(齐次裁剪空间)，投影分为正交投影和透视投影

### 裁剪
将摄像机看不到的顶点剔除

### 屏幕映射
在裁剪空间中的顶点坐标范围为[-1, 1]，需要映射到我们正常的显示器上，比如1920 * 1080的显示器，这个时候坐标仍然是三维的，z就是深度值。

## 光栅化阶段
光栅化阶段分为图元组装->三角形遍历->片元着色器
### 图元组装/三角形设置
把顶点数据组装成简单的基本体(线，点或三角形)
### 三角形遍历
遍历检查屏幕上的像素是否被三角形网格覆盖，被覆盖的区域将生成一个片元，这一阶段还会进行抗锯齿处理
### 片元着色器
这一阶段也是完全可编程的，fragment shader，这里会为每个片元计算颜色，也可以采样纹理的颜色